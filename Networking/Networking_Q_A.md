1.  **Q: What is an Azure VNet, and why is it critical for DevOps?A:** "A VNet is the isolated private network foundation in Azure. For DevOps, it's critical because it's the bedrock we define as Infrastructure as Code. We use Terraform/Bicep to deploy identical VNet topologies across Dev, Test, Prod, ensuring network consistency, security segmentation, and enabling reliable hybrid connectivity – all automated and auditable."
    
2.  **Q: Explain subnetting in Azure. Why not put everything in one big subnet?A:** "Subnets segment the VNet address space for security and operational reasons. Putting everything in one subnet violates least privilege – a compromised web server could directly attack databases. We design tiered subnets (Web, App, DB) with specific NSGs. This segmentation is automated in IaC, reduces blast radius, meets compliance (like PCI), and allows service-specific configurations like AKS subnet delegation."
    
3.  **Q: How do you determine the CIDR block size for a subnet?A:** "We calculate based on maximum expected resource count plus buffer for growth. For example, needing 300 VMs: 2^(32-y) - 2 >= 300. Solving, /23 gives 510 usable hosts (512-2). We use Terraform's cidrsubnet() function to carve this from the VNet space. Always validate with terraform plan to prevent overlap and ensure sufficient addresses for scaling."
    
4.  **Q: What's the primary function of an NSG?A:** "An NSG acts as a stateful firewall controlling traffic _to_ and _from_ subnets or individual NICs. Its core function is enforcing network security policies via rules – allowing only necessary traffic (like App tier to DB on port 1433) and denying everything else by default. We automate all NSG rules via IaC to prevent configuration drift."
    
5.  **Q: Describe a common NSG rule mistake you've seen or fixed.A:** "A classic mistake is using 'Allow \* from Internet' on port 22/3389 for admin access. This is a massive security hole. The fix is strict source IP restriction – only allowing corp IPs or a jumpbox subnet. In our IaC, we parameterize the admin IP range and enforce it via policy. Another is forgetting outbound rules; we always define explicit outbound rules for dependencies like patching servers."
    
6.  **Q: What problem does an Application Security Group (ASG) solve that NSGs alone don't?A:** "NSGs using IP ranges become unmaintainable when resources scale dynamically. ASGs solve this by letting us define rules based on _logical application tiers_ (e.g., 'Allow from asg-app-servers'). When VMs scale in/out, their NICs auto-update the ASG membership. This means NSG rules _never need changing_ for IP changes – a huge win for automation and reliability in IaC deployments."
    
7.  **Q: When would you apply an NSG directly to a NIC instead of a subnet?A:** "Rarely, and only for very specific exceptions. Subnet-level NSGs are standard for tier security. NIC-level NSGs might be used for a single jumpbox needing stricter rules than its subnet, or a legacy app requiring unique rules. But we avoid them because they complicate IaC management and bypass subnet policy. Subnet NSGs are our primary pattern."
    
8.  **Q: Explain the difference between a Public IP and a Private IP in Azure.A:** "A Private IP is used _within_ the VNet or connected networks (like on-prem via ExpressRoute) – it's non-routable on the public internet. Resources communicate internally using private IPs. A Public IP is globally routable on the internet. We only assign Public IPs to edge services like Load Balancers or Application Gateways, _never_ directly to backend VMs like databases, as per security best practices enforced in our IaC."
    
9.  **Q: What does /24 mean in CIDR notation (e.g., 10.0.1.0/24)?A:** "/24 means the first 24 bits of the IP address define the network portion. For 10.0.1.0/24, the network mask is 255.255.255.0. This gives 256 total addresses (2^8), but only 254 are usable for hosts (10.0.1.1 to 10.0.1.254), reserving .0 for network and .255 for broadcast. We use this constantly in IaC for subnet sizing."
    
10.  **Q: How do you calculate the number of usable hosts in a /27 subnet?A:** "For /27, the host bits are 32 - 27 = 5. Total addresses = 2^5 = 32. Usable hosts = 32 -2 = 30 (minus network and broadcast addresses). We use this math in Terraform with cidrhost() and cidrsubnet() to plan address space for VM scalesets or container instances."
    
11.  **Q: Why is using ASGs considered a DevOps best practice for NSG management?A:** "Because ASGs decouple security rules from infrastructure volatility. In dynamic environments where VMs scale constantly, managing NSG rules via IP lists is error-prone and manual. ASGs let us define rules like 'Allow from asg-web-tier' – the membership updates automatically. This is perfect for IaC; we define the ASG once, associate resources via IaC, and the security policy becomes infrastructure-agnostic and resilient to scale events."
    
12.  **Q: Describe how you would structure subnets for a 3-tier web application in IaC.A:** "We'd define the VNet (e.g., 10.1.0.0/16). Then key subnets: snet-frontend (/24) for LB/App Gateway, snet-web (/24) for web servers, snet-app (/24) for app servers, snet-db (/25 for 126 hosts) for databases. Each subnet gets a dedicated NSG: Web NSG allows 80/443 from LB subnet; App NSG allows only from Web subnet on app port; DB NSG allows only from App subnet on DB port. All defined in Terraform modules."
    
13.  **Q: What is service endpoint, and why enable it on a subnet?A:** "A service endpoint extends your VNet identity to Azure PaaS services (like Storage, SQL). Enabling it on a subnet (e.g., snet-app) means traffic to that PaaS service originates _from_ the VNet's private IP space, not the public internet. This allows us to secure the PaaS service with firewall rules _only_ allowing traffic from that specific subnet, significantly tightening access – a key security pattern we enable via IaC."
    
14.  **Q: How do you troubleshoot 'No Network Connectivity' to an Azure VM?A:** "First, check the VM's NSG (subnet and NIC level) for blocking rules – is the port open _and_ is the source IP allowed? Verify the VM's OS firewall. Check if the VM has a Public IP (if needed) and if the LB/frontend config is correct. Use Network Watcher's 'Connection Troubleshoot' from the portal or CLI – it tests the full path, including NSGs and RTALs, pinpointing the exact block."
    
15.  **Q: What's the difference between Basic and Standard SKU Public IPs?A:** "Basic SKU is simple but limited: no zonal redundancy, can't attach directly to VMs (only via LB), and crucially, _cannot_ be associated with an NSG. Standard SKU is required for most production scenarios: zonal aware, can attach to VMs/NICs/LB, supports outbound rules, and _can_ be associated with an NSG for direct VM security. We exclusively use Standard SKU in IaC for production resources."
    
16.  **Q: Why is VNet Peering important for DevOps?A:** "It enables secure, low-latency, private communication between VNets (e.g., Prod VNet to Log Analytics VNet, or Spoke VNets to a Hub). For DevOps, it's vital for connecting environments securely without public exposure. We automate peering setup in IaC, ensuring transitive routing (via UDRs in Hub) and consistent security policies across the network mesh."
    
17.  **Q: How do you ensure NSG rules are consistent across Dev, Test, Prod?A:** "Strictly through Infrastructure as Code. We define NSG rule sets as Terraform/Bicep modules parameterized by environment (e.g., allowed\_ssh\_ips). The _same module_ is called for each environment, with environment-specific variables (like stricter IP ranges in Prod). terraform plan shows differences, and policy-as-code (like Azure Policy) blocks non-compliant manual changes."
    
18.  **Q: What is 'default allow VNet inbound' in NSGs? Is it secure?A:** "Yes, NSGs have a default rule (priority 65000) allowing all traffic _within_ the VNet. While convenient, it's often _too_ permissive for production. Best practice is to _deny_ all VNet traffic by default (using a high-priority deny rule) and then _explicitly allow_ only necessary tier-to-tier communication (e.g., App -> DB). We implement this strict model in our IaC for Prod."
    
19.  **Q: Explain how ASGs simplify NSG rules for a scaling VM Scale Set.A:** "Without ASGs, if a VMSS scales from 5 to 50 instances, you'd need to manually update _every_ NSG rule referencing those IPs – impossible to automate reliably. With ASGs: 1) Define ASG asg-app-servers, 2) In IaC, associate the VMSS NICs to this ASG, 3) Create NSG rule 'Allow from asg-app-servers to DB port 1433'. As the VMSS scales, NICs auto-join/leave the ASG, and the NSG rule _automatically_ uses the current member IPs – zero rule maintenance."
    
20.  **Q: What is the role of CIDR in VNet Peering?A:** "CIDR is critical for avoiding overlap. Peered VNets _must_ have non-overlapping address spaces (e.g., VNet1=10.1.0.0/16, VNet2=10.2.0.0/16). If CIDR blocks overlap, peering fails. During IaC design, we meticulously plan the overall address space (e.g., 10.0.0.0/8) and allocate non-overlapping /16 blocks to each VNet using cidrsubnet(), validated during terraform plan."
    
21.  **Q: How would you restrict SSH access to Linux VMs in a subnet?A:** "In the subnet's NSG: 1) Create a high-priority deny rule blocking _all_ inbound SSH (port 22) from Internet, 2) Create a lower-priority allow rule permitting SSH _only_ from a specific admin IP range (e.g., corp office) or a dedicated snet-jumpbox subnet. Never allow 0.0.0.0/0. We enforce this pattern in all environment IaC templates, with the admin IP range as a variable."
    
22.  **Q: What's a common pitfall when defining NSG rules?A:** "Rule priority mistakes. Lower numbers = higher priority. A common error is creating a broad 'Allow Internet' rule with priority 100, then a specific 'Deny Bad IP' rule with priority 200 – the allow rule matches first, so the deny is ignored. We always design rules top-down: specific denies first, then specific allows, broad denies last. IaC reviews catch this."
    
23.  **Q: Why might you use multiple address spaces in a single VNet?A:** "Primarily for adding non-contiguous address ranges later without recreating the VNet. For example, initial VNet=10.0.0.0/16, but you need more space; you can add 10.1.0.0/16. However, this is complex. Best practice is to size the initial address space large enough (e.g., /8) using cidrsubnet() in IaC to avoid this need. We only add spaces if absolutely necessary."
    
24.  **Q: How does DevOps handle NSG rule changes safely?A:** "Via IaC pull requests. Changes are made in the Terraform/Bicep code, reviewed for security impact (e.g., is this opening an unnecessary port?), tested in non-prod, and deployed through CI/CD pipelines. We use az network watcher show-next-hop pre-deployment to simulate traffic. Never manual portal changes in Prod – policy-as-code enforces this."
    
25.  **Q: What is the significance of the 'VirtualNetwork' service tag in NSGs?A:** "It represents _all_ IP addresses within the _current_ VNet and any _peered_ VNets. Using it as a source/destination (e.g., 'Allow from VirtualNetwork to port 8080') simplifies rules instead of listing all VNet CIDRs. It's dynamic – if you peer a new VNet, the rule automatically includes it. We use this extensively for internal tier communication rules."
    
26.  **Q: How do you secure a database subnet?A:** "Strictly: 1) NSG on DB subnet _denies_ all inbound by default, 2) Only _one_ allow rule: from the specific App tier subnet (or ASG) on the exact DB port (e.g., 1433 for SQL), 3) No Public IP on DB VMs, 4) Enable service endpoints for the PaaS DB if used, restricting its firewall to the App subnet. This is codified in our secure baseline IaC module."
    
27.  **Q: Explain the relationship between a VNet, Subnet, and NSG.A:** "The VNet is the overall private network container (CIDR block). Subnets are segments _within_ the VNet (smaller CIDR blocks), grouping resources by function/tier. An NSG is a firewall _attached_ to either a Subnet (protecting all resources in it) or a NIC (protecting one resource). We attach NSGs to Subnets as the standard pattern for tier security in IaC."
    
28.  **Q: Why is understanding CIDR essential for a DevOps engineer?A:** "It's the language of network design. You need it to plan VNet/subnet sizes without overlap, calculate host capacity for scaling, write correct IaC (Terraform's cidrsubnet()), configure NSG rules accurately (source/dest ranges), troubleshoot connectivity (is the IP in the right subnet?), and communicate effectively with network teams. It's foundational."
    
29.  **Q: What's the first thing you check if an application can't reach an Azure SQL DB?A:** "The NSG on the _App server subnet_. Is there an allow rule for outbound traffic to the SQL port (1433/TCP)? Next, check the Azure SQL Server firewall: is 'Allow Azure services' ON? If not, is the App subnet's CIDR explicitly allowed? We automate SQL firewall rules in IaC to include the App subnet's CIDR."
    
30.  **Q: How do you manage NSG rules for ephemeral environments (e.g., feature branch deployments)?A:** "We use the same IaC modules as Prod, but with environment-specific parameters. For a feature branch VNet, we might allow broader access (e.g., dev team IPs) for debugging, but still enforce tier segmentation. The key is _consistent structure_: same subnet/NSG pattern, just relaxed rules via variables. Terraform destroys the entire environment cleanly, including NSGs."
    
31.  **Q: What is the impact of not associating an NSG to a subnet?A:** "The subnet inherits the _default_ NSG behavior: all inbound traffic from the internet is blocked, but _all traffic within the VNet is allowed_. This is often _too permissive_ for production (e.g., Web tier could directly access DB). Best practice is _always_ associate a custom NSG to every subnet to enforce least privilege – a standard in our IaC templates."
    
32.  **Q: How would you allow only your corporate network to access an internal API in Azure?A:** "1) Place the API backend in a dedicated subnet (snet-api), 2) Create an NSG for snet-api, 3) Add an _inbound_ allow rule: Source = your corp public IP range (e.g., 203.0.113.0/24), Destination = snet-api CIDR, Port = API port (e.g., 8080), Protocol = TCP, Action = Allow, Priority = 100, 4) Add a deny all inbound rule (priority 4096). We parameterize the corp IP range in IaC."